<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ²–ç¸„æ—…è¡Œ ğŸŒº</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts: Zen Maru Gothic for that soft, rounded look -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #FDFCF0; /* Creamy background */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Hide scrollbar for cleaner look */
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }
        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Visible but thin scrollbar for desktop usability */
        .thin-scroll::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        .thin-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .thin-scroll::-webkit-scrollbar-thumb {
            background-color: #e7e5e4; /* stone-200 */
            border-radius: 20px;
        }
        .thin-scroll::-webkit-scrollbar-thumb:hover {
            background-color: #d6d3d1; /* stone-300 */
        }

        /* Custom Animations */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active, .slide-up-leave-active {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .slide-up-enter-from, .slide-up-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }

        /* Ticket jagged edge effect */
        .ticket-edge {
            background-image: radial-gradient(circle at bottom, transparent 6px, white 6px);
            background-size: 15px 10px;
            background-repeat: repeat-x;
            background-position: bottom;
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#FDFCF0',
                        'nook-green': '#8dd6a7',
                        'nook-teal': '#58c7c7',
                        'nook-brown': '#7c6a5a',
                        'sand': '#eaddcf',
                        'soft-orange': '#ffb7b2'
                    }
                }
            }
        }
    </script>
</head>
<body class="text-nook-brown overflow-hidden h-screen w-screen relative">

<div id="app" class="h-full flex flex-col relative max-w-md mx-auto bg-cream shadow-2xl overflow-hidden">

    <!-- Header -->
    <header class="relative shrink-0 h-28 rounded-b-3xl overflow-hidden shadow-lg z-10">
        <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1000&auto=format&fit=crop" 
             class="absolute inset-0 w-full h-full object-cover" alt="Okinawa Beach">
        <div class="absolute inset-0 bg-gradient-to-b from-black/10 to-black/40"></div>
        <div class="absolute bottom-4 left-6 text-white drop-shadow-md">
            <h1 class="text-3xl font-bold tracking-widest mb-0.5 shadow-sm">æ²–ç¸„æ—…è¡Œ ğŸŒº</h1>
            <p class="text-xs opacity-90 flex items-center gap-1">
                <i data-lucide="map-pin" class="w-3 h-3"></i> Okinawaken, Japan
            </p>
        </div>
        
        <!-- Countdown Badge -->
        <div class="absolute top-3 right-4 bg-white/90 backdrop-blur text-nook-brown px-3 py-1.5 rounded-2xl text-xs font-bold shadow-md flex items-center gap-1">
            <i data-lucide="timer" class="w-4 h-4"></i>
            å‡ºç™¼å€’æ•¸ {{ countdown }} å¤©
        </div>
    </header>

    <!-- Main Scrollable Content Area -->
    <main class="flex-1 overflow-y-auto hide-scroll pb-24 px-4 pt-6 space-y-6">
        
        <!-- VIEW: ITINERARY -->
        <div v-if="currentTab === 'itinerary'" class="space-y-6">
            
            <!-- Weather Card -->
            <div class="bg-white rounded-3xl p-4 shadow-sm border border-stone-100 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-50 p-2 rounded-full text-blue-400">
                        <i data-lucide="sun" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400">ä»Šæ—¥å¤©æ°£é å ±</div>
                        <div class="text-xl font-bold">24Â°C <span class="text-sm font-normal text-gray-500">æ™´ã‚Œ</span></div>
                    </div>
                </div>
                <div class="text-right text-xs text-gray-400">
                    <div>é™é›¨æ©Ÿç‡ 20%</div>
                    <div>æ¿•åº¦ 60%</div>
                </div>
            </div>

            <!-- Date Selector -->
            <div>
                <h3 class="text-lg font-bold mb-3 pl-2 flex items-center gap-2">
                    <span class="w-2 h-6 bg-nook-green rounded-full"></span> è¡Œç¨‹æ—¥æœŸ
                </h3>
                <div class="flex overflow-x-auto gap-3 pb-2 px-1 thin-scroll">
                    <button v-for="(day, index) in days" :key="index"
                            @click="selectedDay = index"
                            class="flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center gap-1 transition-all border-2"
                            :class="selectedDay === index ? 'bg-nook-teal border-nook-teal text-white shadow-md scale-105' : 'bg-white border-transparent text-gray-400'">
                        <span class="text-xs font-bold">{{ day.weekday }}</span>
                        <span class="text-sm font-bold">{{ day.date }}</span>
                    </button>
                </div>
            </div>

            <!-- Timeline -->
            <div class="relative pl-4 space-y-6">
                <!-- Vertical Line -->
                <div class="absolute left-[27px] top-2 bottom-0 w-0.5 bg-stone-200 -z-10"></div>

                <transition-group name="slide-up">
                    <div v-for="(item, idx) in currentItinerary" :key="item.id" 
                         class="relative" :class="item.travelTime ? 'pt-6' : ''">
                        
                        <!-- Travel Time Indicator (Shows on the line above the item) -->
                        <div v-if="item.travelTime" class="absolute -top-3 left-[28px] transform -translate-x-1/2 z-0 flex flex-col items-center">
                            <div class="bg-stone-100/90 backdrop-blur-sm text-[10px] text-gray-500 px-2 py-0.5 rounded-full border border-stone-200 whitespace-nowrap flex items-center gap-1 shadow-sm">
                                <!-- Dynamic Icon based on travelMode -->
                                <i v-if="item.travelMode === 'walk'" data-lucide="footprints" class="w-3 h-3 text-nook-brown"></i>
                                <i v-else-if="item.travelMode === 'bike'" data-lucide="bike" class="w-3 h-3 text-nook-teal"></i>
                                <i v-else-if="item.travelMode === 'train'" data-lucide="train-front" class="w-3 h-3 text-blue-500"></i>
                                <i v-else data-lucide="car" class="w-3 h-3 text-nook-green"></i>
                                {{ item.travelTime }}
                            </div>
                        </div>

                        <div class="flex gap-4 items-start group">
                            <!-- Time Bubble -->
                            <div class="w-14 shrink-0 flex flex-col items-center bg-white border-2 border-stone-100 rounded-xl py-2 shadow-sm z-10 h-min">
                                <span class="text-xs font-bold text-gray-600">{{ item.time }}</span>
                            </div>
                            
                            <!-- Content Card -->
                            <div class="flex-1 bg-white rounded-2xl p-4 shadow-sm border border-stone-100 relative overflow-hidden">
                                
                                <!-- Important Alert (Top of Card) -->
                                <div v-if="item.important" class="mb-3 bg-red-50 border border-red-100 text-red-500 text-xs font-bold px-3 py-2 rounded-xl flex items-center gap-2 animate-pulse">
                                    <i data-lucide="shirt" class="w-4 h-4 shrink-0"></i>
                                    <span>{{ item.important }}</span>
                                </div>

                                <!-- Category Badge -->
                                <div class="mb-2 flex justify-between items-start">
                                    <span class="inline-block text-[10px] px-2 py-0.5 rounded-full font-bold"
                                          :class="getCategoryColor(item.type)">
                                        {{ getCategoryName(item.type) }}
                                    </span>
                                </div>

                                <h4 class="font-bold text-lg leading-tight mb-2">{{ item.title }}</h4>
                                
                                <p class="text-xs text-gray-400 flex items-center gap-1 mb-3">
                                    <i data-lucide="map-pin" class="w-3 h-3"></i> {{ item.location }}
                                </p>

                                <!-- Notes Block (Visible directly) with whitespace-pre-line -->
                                <div v-if="item.notes" class="bg-stone-50 p-3 rounded-xl border border-stone-100 text-xs text-gray-600 mb-3 leading-relaxed relative whitespace-pre-line">
                                    <span class="absolute -top-2 left-3 bg-white px-1 text-[10px] text-gray-300 font-bold tracking-wider">MEMO</span>
                                    {{ item.notes }}
                                </div>

                                <!-- Navigation Button -->
                                <a :href="'https://www.google.com/maps/search/?api=1&query=' + item.location" target="_blank"
                                   class="w-full bg-blue-50 hover:bg-blue-100 text-blue-500 py-2 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-colors">
                                    <i data-lucide="navigation" class="w-3 h-3"></i> å°èˆª (Google Maps)
                                </a>
                            </div>
                        </div>
                    </div>
                </transition-group>
                
                <!-- Empty State -->
                <div v-if="currentItinerary.length === 0" class="text-center py-10 text-gray-400">
                    <p>è¡Œç¨‹è¼‰å…¥ä¸­æˆ–æœ¬æ—¥è‡ªç”±æ´»å‹• ğŸ–ï¸</p>
                </div>
            </div>
        </div>

        <!-- VIEW: EXPENSES -->
        <div v-if="currentTab === 'expenses'" class="space-y-6">
            <!-- Dashboard -->
            <div class="bg-nook-green/20 rounded-[2rem] p-6 text-center relative overflow-hidden">
                <div class="absolute -top-10 -left-10 w-32 h-32 bg-nook-green/20 rounded-full blur-xl"></div>
                <div class="relative z-10">
                    <p class="text-sm text-nook-brown/70 mb-1">ç¸½æ”¯å‡º (Total)</p>
                    <h2 class="text-4xl font-bold text-nook-brown mb-2">NT$ {{ formatNumber(totalExpenseTWD) }}</h2>
                    <div class="inline-block bg-white/60 px-3 py-1 rounded-full text-xs font-bold text-nook-brown/80">
                        ç´„ Â¥ {{ formatNumber(totalExpenseJPY) }}
                    </div>
                </div>
            </div>

            <!-- Add Button -->
            <button @click="showExpenseModal = true" class="w-full py-4 bg-nook-brown text-white rounded-2xl font-bold shadow-lg shadow-nook-brown/30 flex items-center justify-center gap-2 active:scale-95 transition-transform">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> è¨˜ä¸€ç­†
            </button>

            <!-- Expense List -->
            <div>
                <h3 class="text-lg font-bold mb-3 pl-2 flex items-center gap-2">
                    <span class="w-2 h-6 bg-soft-orange rounded-full"></span> æ”¯å‡ºæ˜ç´°
                </h3>
                <div class="space-y-3">
                    <div v-for="expense in sortedExpenses" :key="expense.id" class="bg-white rounded-2xl p-4 flex justify-between items-center shadow-sm border border-stone-50">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-stone-100 flex items-center justify-center text-xl">
                                {{ getCategoryIcon(expense.category) }}
                            </div>
                            <div>
                                <div class="font-bold text-sm">{{ expense.title }}</div>
                                <div class="text-xs text-gray-400">{{ expense.payer }} ä»˜æ¬¾</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-nook-brown">Â¥ {{ formatNumber(expense.amount) }}</div>
                            <div class="text-xs text-gray-400">â‰ˆ NT$ {{ formatNumber(Math.round(expense.amount * 0.22)) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: BOOKINGS -->
        <div v-if="currentTab === 'bookings'" class="space-y-6">
            
            <!-- Booking Sub-Navigation -->
            <div class="flex p-1 bg-stone-100 rounded-xl mb-4 overflow-x-auto">
                <button 
                    v-for="tab in bookingTabs" 
                    :key="tab.id"
                    @click="activeBookingTab = tab.id"
                    class="flex-1 py-2.5 px-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-1 whitespace-nowrap"
                    :class="activeBookingTab === tab.id ? 'bg-white text-nook-brown shadow-sm' : 'text-gray-400 hover:text-gray-600'"
                >
                    <i :data-lucide="tab.icon" class="w-3.5 h-3.5"></i>
                    {{ tab.label }}
                </button>
            </div>

            <!-- 1. FLIGHT TAB -->
            <div v-if="activeBookingTab === 'flight'" class="space-y-6">
                
                <!-- Outbound Flight -->
                <div>
                    <h4 class="text-xs font-bold text-gray-400 mb-2 pl-2">OUTBOUND (å»ç¨‹)</h4>
                    <div class="bg-white rounded-3xl shadow-md overflow-hidden relative">
                        <div class="p-5 bg-nook-teal text-white relative">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-xs opacity-80">AIRLINE</p>
                                    <p class="font-bold tracking-wider">Thai AirAsia</p>
                                    <p class="text-xs font-bold opacity-90">FD230</p>
                                </div>
                                <i data-lucide="plane" class="w-6 h-6"></i>
                            </div>
                            <div class="flex justify-between items-center">
                                <div><div class="text-3xl font-bold">TPE</div><div class="text-xs opacity-80">Taipei</div></div>
                                <div class="flex-1 px-4 flex flex-col items-center">
                                    <div class="text-[10px] mb-1">1h 30m</div>
                                    <div class="w-full h-0.5 bg-white/50 relative"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-white rounded-full"></div></div>
                                </div>
                                <div class="text-right"><div class="text-3xl font-bold">OKA</div><div class="text-xs opacity-80">Naha</div></div>
                            </div>
                        </div>
                        <div class="relative h-6 bg-white">
                            <div class="absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-cream rounded-full"></div>
                            <div class="absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-cream rounded-full"></div>
                            <div class="absolute top-1/2 left-4 right-4 border-t-2 border-dashed border-gray-200"></div>
                        </div>
                        <div class="p-5 pt-2 space-y-3">
                            <!-- Early Arrival Reminder -->
                            <div class="bg-orange-50 border border-orange-100 text-orange-600 text-xs font-bold px-3 py-2 rounded-xl flex items-center gap-2 animate-pulse">
                                <i data-lucide="alarm-clock" class="w-4 h-4 shrink-0"></i>
                                <span>å»ºè­°ææ—©æ–¼ 11:30 å‰æŠµé”æ©Ÿå ´</span>
                            </div>

                            <div class="flex justify-between">
                                <div><p class="text-xs text-gray-400">DATE</p><p class="font-bold text-nook-brown">28 MAR</p></div>
                                <div><p class="text-xs text-gray-400">TIME</p><p class="font-bold text-nook-brown">13:30</p></div>
                                <div><p class="text-xs text-gray-400">GATE</p><p class="font-bold text-nook-brown">B6</p></div>
                                <div><p class="text-xs text-gray-400">SEAT</p><p class="font-bold text-nook-brown">--</p></div>
                            </div>
                            <div class="bg-stone-50 p-3 rounded-xl border border-stone-100 space-y-2">
                                <div class="flex items-start gap-3">
                                    <i data-lucide="luggage" class="w-4 h-4 text-nook-teal mt-0.5"></i>
                                    <div>
                                        <p class="text-[10px] font-bold text-gray-400">BAGGAGE (è¡Œæ)</p>
                                        <p class="text-xs font-bold text-nook-brown">è¨—é‹ 20kg / æ‰‹æ 7kg</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <i data-lucide="info" class="w-4 h-4 text-nook-teal mt-0.5"></i>
                                    <div>
                                        <p class="text-[10px] font-bold text-gray-400">AIRCRAFT (æ©Ÿå‹)</p>
                                        <p class="text-xs font-bold text-nook-brown">Airbus A320</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inbound Flight -->
                <div>
                    <h4 class="text-xs font-bold text-gray-400 mb-2 pl-2">INBOUND (å›ç¨‹)</h4>
                    <div class="bg-white rounded-3xl shadow-md overflow-hidden relative">
                        <div class="p-5 bg-soft-orange text-white relative">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-xs opacity-80">AIRLINE</p>
                                    <p class="font-bold tracking-wider">China Airlines</p>
                                    <p class="text-xs font-bold opacity-90">CI121</p>
                                </div>
                                <i data-lucide="plane" class="w-6 h-6 transform rotate-180"></i>
                            </div>
                            <div class="flex justify-between items-center">
                                <div><div class="text-3xl font-bold">OKA</div><div class="text-xs opacity-80">Naha</div></div>
                                <div class="flex-1 px-4 flex flex-col items-center">
                                    <div class="text-[10px] mb-1">1h 35m</div>
                                    <div class="w-full h-0.5 bg-white/50 relative"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-white rounded-full"></div></div>
                                </div>
                                <div class="text-right"><div class="text-3xl font-bold">TPE</div><div class="text-xs opacity-80">Taipei</div></div>
                            </div>
                        </div>
                        <div class="relative h-6 bg-white">
                            <div class="absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-cream rounded-full"></div>
                            <div class="absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-cream rounded-full"></div>
                            <div class="absolute top-1/2 left-4 right-4 border-t-2 border-dashed border-gray-200"></div>
                        </div>
                        <div class="p-5 pt-2 space-y-3">
                            <!-- Early Arrival Reminder -->
                            <div class="bg-orange-50 border border-orange-100 text-orange-600 text-xs font-bold px-3 py-2 rounded-xl flex items-center gap-2 animate-pulse">
                                <i data-lucide="alarm-clock" class="w-4 h-4 shrink-0"></i>
                                <span>å»ºè­°ææ—©æ–¼ 09:50 å‰æŠµé”æ©Ÿå ´</span>
                            </div>

                            <div class="flex justify-between">
                                <div><p class="text-xs text-gray-400">DATE</p><p class="font-bold text-nook-brown">04 APR</p></div>
                                <div><p class="text-xs text-gray-400">TIME</p><p class="font-bold text-nook-brown">11:50</p></div>
                                <div><p class="text-xs text-gray-400">GATE</p><p class="font-bold text-nook-brown">41</p></div>
                                <div><p class="text-xs text-gray-400">SEAT</p><p class="font-bold text-nook-brown">--</p></div>
                            </div>
                            <div class="bg-stone-50 p-3 rounded-xl border border-stone-100 space-y-2">
                                <div class="flex items-start gap-3">
                                    <i data-lucide="luggage" class="w-4 h-4 text-soft-orange mt-0.5"></i>
                                    <div>
                                        <p class="text-[10px] font-bold text-gray-400">BAGGAGE (è¡Œæ)</p>
                                        <p class="text-xs font-bold text-nook-brown">è¨—é‹ 23kg / æ‰‹æ 7kg</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <i data-lucide="info" class="w-4 h-4 text-soft-orange mt-0.5"></i>
                                    <div>
                                        <p class="text-[10px] font-bold text-gray-400">AIRCRAFT (æ©Ÿå‹)</p>
                                        <p class="text-xs font-bold text-nook-brown">Airbus A321neo</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 2. ACCOMMODATION TAB -->
            <div v-if="activeBookingTab === 'stay'" class="space-y-6">
                 <!-- Hotel 1 -->
                 <div class="bg-white rounded-3xl overflow-hidden shadow-md">
                     <div class="h-32 relative">
                         <img src="https://images.unsplash.com/photo-1618245318763-a15156d6b23c?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover">
                         <div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded-lg text-xs font-bold">3 Nights</div>
                     </div>
                     <div class="p-4">
                         <h4 class="font-bold text-lg mb-1">Karry CONDO CHURAUMI</h4>
                         <p class="text-xs text-gray-400 mb-3">Motobu</p>
                         <div class="flex gap-4 text-sm bg-stone-50 p-3 rounded-xl">
                             <div class="flex-1"><div class="text-xs text-gray-400">Check-in</div><div class="font-bold">3/28 20:00</div></div>
                             <div class="w-px bg-gray-200"></div>
                             <div class="flex-1"><div class="text-xs text-gray-400">Check-out</div><div class="font-bold">3/31 11:30</div></div>
                         </div>
                         <a href="https://www.google.com/maps/search/?api=1&query=Karry CONDO CHURAUMI" target="_blank" class="mt-3 block text-center bg-stone-100 text-gray-500 py-2 rounded-xl text-xs font-bold">å°èˆª</a>
                     </div>
                 </div>

                 <!-- Hotel 2 -->
                 <div class="bg-white rounded-3xl overflow-hidden shadow-md">
                     <div class="h-32 relative">
                         <img src="https://images.unsplash.com/photo-1596394516093-501ba68a0ba6?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover">
                         <div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded-lg text-xs font-bold">2 Nights</div>
                     </div>
                     <div class="p-4">
                         <h4 class="font-bold text-lg mb-1">Aqua Resort in Chatan</h4>
                         <p class="text-xs text-gray-400 mb-3">Chatan</p>
                         <div class="flex gap-4 text-sm bg-stone-50 p-3 rounded-xl">
                             <div class="flex-1"><div class="text-xs text-gray-400">Check-in</div><div class="font-bold">3/31 19:00</div></div>
                             <div class="w-px bg-gray-200"></div>
                             <div class="flex-1"><div class="text-xs text-gray-400">Check-out</div><div class="font-bold">4/2 08:00</div></div>
                         </div>
                         <a href="https://www.google.com/maps/search/?api=1&query=ã‚¢ã‚¯ã‚¢ãƒªã‚¾ãƒ¼ãƒˆã‚¤ãƒ³åŒ—è°·" target="_blank" class="mt-3 block text-center bg-stone-100 text-gray-500 py-2 rounded-xl text-xs font-bold">å°èˆª</a>
                     </div>
                 </div>

                 <!-- Hotel 3 -->
                 <div class="bg-white rounded-3xl overflow-hidden shadow-md">
                     <div class="h-32 relative">
                         <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover">
                         <div class="absolute bottom-2 left-2 bg-white/90 px-2 py-1 rounded-lg text-xs font-bold">2 Nights</div>
                     </div>
                     <div class="p-4">
                         <h4 class="font-bold text-lg mb-1">Tokyu Stay Okinawa Naha</h4>
                         <p class="text-xs text-gray-400 mb-3">Naha</p>
                         <div class="flex gap-4 text-sm bg-stone-50 p-3 rounded-xl">
                             <div class="flex-1"><div class="text-xs text-gray-400">Check-in</div><div class="font-bold">4/2 19:30</div></div>
                             <div class="w-px bg-gray-200"></div>
                             <div class="flex-1"><div class="text-xs text-gray-400">Check-out</div><div class="font-bold">4/4 09:00</div></div>
                         </div>
                         <a href="https://www.google.com/maps/search/?api=1&query=æ±æ€¥ã‚¹ãƒ†ã‚¤æ²–ç¸„é‚£è¦‡" target="_blank" class="mt-3 block text-center bg-stone-100 text-gray-500 py-2 rounded-xl text-xs font-bold">å°èˆª</a>
                     </div>
                 </div>
            </div>

            <!-- 3. CAR RENTAL TAB -->
            <div v-if="activeBookingTab === 'car'" class="space-y-6">
                <div class="bg-white rounded-3xl p-5 shadow-md border border-stone-50 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-orange-50 rounded-bl-[4rem] -z-0"></div>
                    <div class="relative z-10">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-14 h-14 bg-orange-100 rounded-2xl flex items-center justify-center text-orange-500 shadow-sm">
                                <i data-lucide="car" class="w-8 h-8"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-xl">OTS Rent-a-car</h4>
                                <p class="text-sm text-gray-400">Honda Fit (White)</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="bg-stone-50 p-3 rounded-xl border border-stone-100">
                                <p class="text-[10px] text-gray-400 font-bold mb-1">PICK-UP (å–è»Š)</p>
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-nook-brown">è‡¨ç©ºè±å´ç‡Ÿæ¥­æ‰€</span>
                                    <span class="text-sm">3/28 18:00</span>
                                </div>
                            </div>
                            <div class="bg-stone-50 p-3 rounded-xl border border-stone-100">
                                <p class="text-[10px] text-gray-400 font-bold mb-1">RETURN (é‚„è»Š)</p>
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-nook-brown">è‡¨ç©ºè±å´ç‡Ÿæ¥­æ‰€</span>
                                    <span class="text-sm">4/2 16:30</span>
                                </div>
                            </div>
                        </div>
                        <a href="https://www.google.com/maps/search/?api=1&query=OTSãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ è‡¨ç©ºè±Šå´å–¶æ¥­æ‰€" target="_blank" class="mt-4 w-full bg-orange-50 text-orange-500 py-3 rounded-xl text-xs font-bold flex items-center justify-center gap-2">
                            <i data-lucide="navigation" class="w-3 h-3"></i> å°èˆªè‡³ç‡Ÿæ¥­æ‰€
                        </a>
                    </div>
                </div>
            </div>

            <!-- 4. TICKETS TAB -->
            <div v-if="activeBookingTab === 'ticket'" class="space-y-6">
                <!-- Activity Vouchers -->
                <div class="grid grid-cols-1 gap-3">
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-50 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-100 p-2 rounded-full text-blue-500"><i data-lucide="ticket" class="w-5 h-5"></i></div>
                            <div>
                                <div class="font-bold text-sm">ç¾éº—æµ·æ°´æ—é¤¨</div>
                                <div class="text-xs text-gray-400">é›»å­æ†‘è­‰</div>
                            </div>
                        </div>
                        <span class="bg-stone-100 text-gray-500 text-[10px] px-2 py-1 rounded">View</span>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-50 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="bg-green-100 p-2 rounded-full text-green-600"><i data-lucide="fish" class="w-5 h-5"></i></div>
                            <div>
                                <div class="font-bold text-sm">DMM æ°´æ—é¤¨</div>
                                <div class="text-xs text-gray-400">QR Code</div>
                            </div>
                        </div>
                        <span class="bg-stone-100 text-gray-500 text-[10px] px-2 py-1 rounded">View</span>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-50 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="bg-yellow-100 p-2 rounded-full text-yellow-600"><i data-lucide="sun" class="w-5 h-5"></i></div>
                            <div>
                                <div class="font-bold text-sm">å…ƒæ°£æ‘</div>
                                <div class="text-xs text-gray-400">é ç´„ç¢ºèªä¿¡</div>
                            </div>
                        </div>
                        <span class="bg-stone-100 text-gray-500 text-[10px] px-2 py-1 rounded">View</span>
                    </div>
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-stone-50 text-center flex flex-col items-center justify-center h-20 border-dashed border-2 border-gray-200 cursor-pointer hover:bg-stone-50 text-gray-400">
                        <i data-lucide="plus" class="w-5 h-5 mb-1"></i>
                        <span class="text-xs">æ–°å¢æ†‘è­‰</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="shrink-0 bg-white/90 backdrop-blur-md pb-3 pt-2 px-6 rounded-t-3xl shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.1)] absolute bottom-0 w-full z-40">
        <div class="flex justify-between items-center">
            <button @click="currentTab = 'itinerary'" 
                    class="flex flex-col items-center gap-0.5 w-16 transition-all duration-300"
                    :class="currentTab === 'itinerary' ? 'text-nook-teal -translate-y-1' : 'text-gray-300'">
                <div class="p-1.5 rounded-2xl transition-colors" :class="currentTab === 'itinerary' ? 'bg-nook-teal/10' : ''">
                    <i data-lucide="calendar-days" class="w-5 h-5"></i>
                </div>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>

            <button @click="currentTab = 'expenses'" 
                    class="flex flex-col items-center gap-0.5 w-16 transition-all duration-300"
                    :class="currentTab === 'expenses' ? 'text-soft-orange -translate-y-1' : 'text-gray-300'">
                 <div class="p-1.5 rounded-2xl transition-colors" :class="currentTab === 'expenses' ? 'bg-soft-orange/10' : ''">
                    <i data-lucide="wallet" class="w-5 h-5"></i>
                </div>
                <span class="text-[10px] font-bold">è¨˜å¸³</span>
            </button>

            <button @click="currentTab = 'bookings'" 
                    class="flex flex-col items-center gap-0.5 w-16 transition-all duration-300"
                    :class="currentTab === 'bookings' ? 'text-nook-green -translate-y-1' : 'text-gray-300'">
                 <div class="p-1.5 rounded-2xl transition-colors" :class="currentTab === 'bookings' ? 'bg-nook-green/10' : ''">
                    <i data-lucide="ticket" class="w-5 h-5"></i>
                </div>
                <span class="text-[10px] font-bold">é å®š</span>
            </button>
        </div>
    </nav>

    <!-- ADD EXPENSE MODAL -->
    <transition name="slide-up">
        <div v-if="showExpenseModal" class="absolute inset-0 z-50 bg-white flex flex-col">
            <div class="p-6 flex-1 flex flex-col">
                <div class="flex justify-between items-center mb-8">
                    <button @click="showExpenseModal = false" class="text-gray-400">å–æ¶ˆ</button>
                    <h3 class="font-bold text-lg">æ–°å¢æ”¯å‡º</h3>
                    <button @click="addExpense" class="text-nook-teal font-bold">å®Œæˆ</button>
                </div>

                <!-- Amount Display -->
                <div class="flex flex-col items-center justify-center mb-8 bg-stone-50 py-8 rounded-3xl">
                    <span class="text-sm text-gray-400 mb-2">é‡‘é¡ (JPY)</span>
                    <div class="text-5xl font-bold text-nook-brown tracking-tighter">
                        <span class="text-2xl mr-1">Â¥</span>{{ newExpense.amount || '0' }}
                    </div>
                    <div class="text-sm text-gray-400 mt-2">â‰ˆ NT$ {{ Math.round((parseInt(newExpense.amount) || 0) * 0.22) }}</div>
                </div>

                <!-- Inputs -->
                <div class="space-y-4 mb-6">
                    <input v-model="newExpense.title" type="text" placeholder="æ¶ˆè²»é …ç›® (ä¾‹å¦‚: æ‹‰éºµ)" class="w-full bg-stone-50 p-4 rounded-2xl outline-none font-bold text-center">
                    
                    <div class="flex gap-2 overflow-x-auto pb-2">
                        <button v-for="cat in expenseCategories" :key="cat.id" 
                                @click="newExpense.category = cat.id"
                                class="px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors"
                                :class="newExpense.category === cat.id ? 'bg-nook-brown text-white' : 'bg-stone-100 text-gray-500'">
                            {{ cat.emoji }} {{ cat.name }}
                        </button>
                    </div>

                    <div class="flex justify-center gap-4">
                         <label class="flex items-center gap-2 text-sm font-bold text-gray-600">
                             <input type="radio" v-model="newExpense.payer" value="Me" class="accent-nook-brown">
                             æˆ‘ä»˜çš„
                         </label>
                         <label class="flex items-center gap-2 text-sm font-bold text-gray-600">
                             <input type="radio" v-model="newExpense.payer" value="Partner" class="accent-nook-brown">
                             å°æ–¹ä»˜çš„
                         </label>
                    </div>
                </div>

                <!-- Custom Numeric Keypad -->
                <div class="mt-auto grid grid-cols-3 gap-2">
                    <button v-for="n in [1,2,3,4,5,6,7,8,9]" :key="n" @click="appendNumber(n)" class="h-14 bg-stone-50 rounded-xl font-bold text-xl hover:bg-stone-100 active:scale-95 transition-transform">{{ n }}</button>
                    <button @click="appendNumber('.')" class="h-14 bg-stone-50 rounded-xl font-bold text-xl hover:bg-stone-100">.</button>
                    <button @click="appendNumber(0)" class="h-14 bg-stone-50 rounded-xl font-bold text-xl hover:bg-stone-100">0</button>
                    <button @click="backspaceNumber" class="h-14 bg-stone-100 rounded-xl font-bold text-xl hover:bg-stone-200 flex items-center justify-center">
                        <i data-lucide="delete" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </transition>

</div>

<script>
    const { createApp, ref, computed, onMounted, onUpdated } = Vue;

    createApp({
        setup() {
            // State
            const currentTab = ref('itinerary');
            const selectedDay = ref(0);
            const showExpenseModal = ref(false);
            const activeBookingTab = ref('flight'); // Set default to flight
            const today = new Date();
            const tripDate = new Date(2026, 2, 28); // 2026/3/28

            // Data
            const bookingTabs = [
                { id: 'flight', label: 'æ©Ÿç¥¨', icon: 'plane' },
                { id: 'stay', label: 'ä½å®¿', icon: 'bed' },
                { id: 'car', label: 'ç§Ÿè»Š', icon: 'car' },
                { id: 'ticket', label: 'ç¥¨åˆ¸', icon: 'ticket' }
            ];

            const days = [
                { date: '3/28', weekday: 'é€±å…­', fullDate: '2026-03-28' },
                { date: '3/29', weekday: 'é€±æ—¥', fullDate: '2026-03-29' },
                { date: '3/30', weekday: 'é€±ä¸€', fullDate: '2026-03-30' },
                { date: '3/31', weekday: 'é€±äºŒ', fullDate: '2026-03-31' },
                { date: '4/1', weekday: 'é€±ä¸‰', fullDate: '2026-04-01' },
                { date: '4/2', weekday: 'é€±å››', fullDate: '2026-04-02' },
                { date: '4/3', weekday: 'é€±äº”', fullDate: '2026-04-03' },
                { date: '4/4', weekday: 'é€±å…­', fullDate: '2026-04-04' },
            ];

            const itineraryData = {
                0: [ // 3/28 (Day 1)
                    { id: 101, time: '17:00', title: 'Bic Camera (ç©ºæ¸¯é–€å¸‚)', location: 'Air Bic Camera é‚£è¦‡ç©ºæ¸¯åº—', type: 'shopping', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-20:30\nè²· ELECOM è¡Œå‹•é›»æº 10000mah' },
                    { id: 102, time: '18:00', title: 'OTS ç§Ÿè»Š', location: 'OTSãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ è‡¨ç©ºè±Šå´å–¶æ¥­æ‰€', type: 'transport', travelTime: 'ç´„15åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘08:00-19:00\nå–è»Š' },
                    { id: 103, time: '19:00', title: 'æš–æš®æ‹‰éºµ åè­·åº—', location: 'ãƒ©ãƒ¼ãƒ¡ãƒ³ æš–æš® åè­·åº—', type: 'food', travelTime: 'ç´„1.5å°æ™‚', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-02:00\nè½èªªç…é¤ƒä¹Ÿä¸éŒ¯ï¼' },
                    { id: 104, time: '20:00', title: 'ä½å®¿ Check-in', location: 'Karry CONDO CHURAUMI', type: 'stay', travelTime: 'ç´„15åˆ†', notes: 'Check-in æ™‚é–“é€šå¸¸è‡³ 21:00' },
                ],
                1: [ // 3/29 (Day 2)
                    { id: 201, time: '09:30', title: 'æ˜Ÿå·´å…‹æœ¬éƒ¨', location: 'ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ ã‚³ãƒ¼ãƒ’ãƒ¼ æ²–ç¸„æœ¬éƒ¨ç”ºåº—', type: 'food', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘07:00-22:00\nåƒæ—©é¤' },
                    { id: 202, time: '10:30', title: 'ä»Šæ­¸ä»åŸéºè·¡', location: 'ä»Šå¸°ä»åŸè·¡', type: 'sightseeing', travelTime: 'ç´„15åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘08:00-18:00\nçœ‹éºè·¡' },
                    { id: 203, time: '12:00', title: 'ä»Šå¸°ä»é…’é€ æ‰€', location: '(æœ‰)ä»Šå¸°ä»é…’é€ ', type: 'shopping', travelTime: 'ç´„5åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘09:00-17:00 (å¹³æ—¥)\nâ¤ï¸ è²·ã€Œä¹™ç¾½å±±éº“æ³¡ç››å„ªæ ¼é…’ã€' },
                    { id: 204, time: '13:00', title: 'Kurumaebi Kitchen TAMAYA', location: 'ãã‚‹ã¾ãˆã³ã‚­ãƒƒãƒãƒ³TAMAYA', type: 'food', travelTime: 'ç´„30åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-18:00\nåƒè¦å­é¤' },
                    { id: 205, time: '14:30', title: 'Gelateria Papa', location: 'Gelateria Papa', type: 'food', travelTime: 'ç´„15åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-18:00\nç„¡æ·»åŠ ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ åƒå†°æ·‡æ·‹' },
                    { id: 206, time: '15:30', title: 'Shinmei Coffee', location: 'Sinmay Coffee Okinawa', type: 'food', travelTime: 'ç´„10åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-18:00\nã€Œç¾åˆ¨ç”Ÿé»‘ç³–æ‹¿éµã€@ä»Šæ­¸ä»æ‘' },
                    { id: 207, time: '16:30', title: 'MaxValu Nago', location: 'ãƒãƒƒã‚¯ã‚¹ãƒãƒªãƒ¥åè­·åº—', type: 'shopping', travelTime: 'ç´„20åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘24å°æ™‚ç‡Ÿæ¥­\nè²·ä¼´æ‰‹ç¦®' },
                    { id: 208, time: '19:00', title: 'ç™¾å¹´å¤å®¶', location: 'ç™¾å¹´å¤å®¶ å¤§å®¶', type: 'food', travelTime: 'ç´„15åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-15:00 / 18:00-22:00\nåƒæ™šé¤' },
                    { id: 209, time: '20:30', title: 'å›ä½å®¿', location: 'Karry CONDO CHURAUMI', type: 'stay', travelTime: 'ç´„20åˆ†', notes: '' }
                ],
                2: [ // 3/30 (Day 3)
                    { id: 301, time: '08:00', title: 'CAMEL SANDWICH', location: '278-1 Urasaki, Motobu, Kunigami District, Okinawa 905-0217æ—¥æœ¬', type: 'food', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘09:00-17:00\nè²·æ—©é¤ & SMOOTHIE' },
                    { id: 302, time: '09:00', title: 'æŠµé”å…ƒæ°£æ‘', location: 'ã‚‚ã¨ã¶å…ƒæ°—æ‘', type: 'sightseeing', travelTime: 'ç´„10åˆ†', important: 'é‡è¦ï¼šè«‹å‹™å¿…æ”œå¸¶æ›¿æ›è¡£ç‰©ï¼(æœƒæœ‰ä¸‹æ°´æ´»å‹•)', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘08:00-18:00\næº–å‚™åƒåŠ æ´»å‹•' },
                    { id: 303, time: '09:30', title: 'æ‘¸æµ·è±šé«”é©—', location: 'ã‚‚ã¨ã¶å…ƒæ°—æ‘', type: 'sightseeing', notes: 'è¿‘è·é›¢æ¥è§¸' },
                    { id: 304, time: '10:30', title: 'èˆ‡æµ·è±šå…±æ¸¸', location: 'ã‚‚ã¨ã¶å…ƒæ°—æ‘', type: 'sightseeing', notes: 'ä¸‹æ°´äº’å‹•' },
                    { id: 305, time: '11:30', title: 'æ´»å‹•çµæŸ', location: 'Parking Lot', type: 'transport', notes: 'è»Šä¸Šæ›è¡£æœ' },
                    { id: 306, time: '12:30', title: 'ç‡’è‚‰æœ¬éƒ¨ç‰§å ´', location: 'ç„¼è‚‰ ã‚‚ã¨ã¶ç‰§å ´ ã‚‚ã¨ã¶åº—', type: 'food', travelTime: 'ç´„10åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-15:00 / 17:00-22:00\nåƒåˆé¤' },
                    { id: 307, time: '14:00', title: 'ç€¨åº•å³¶', location: 'ç€¬åº•å³¶', type: 'sightseeing', travelTime: 'ç´„10åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘09:00-17:00 (æµ·ç˜)\néš¨æ„æ™ƒæ™ƒ' },
                    { id: 308, time: '15:00', title: 'è°·èŒ¶å…¬åœ’', location: 'è°·èŒ¶å…¬åœ’', type: 'sightseeing', travelTime: 'ç´„20åˆ†', notes: 'çœ‹å‹•ç‰©' },
                    { id: 309, time: '17:00', title: 'èŠ±äººé€¢', location: 'ãƒ”ã‚¶å–«èŒ¶ èŠ±äººé€¢', type: 'food', travelTime: 'ç´„20åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:30-19:00 (é€±äºŒä¸‰ä¼‘)\nåƒæ™šé¤' },
                    { id: 310, time: '20:00', title: 'å›ä½å®¿', location: 'Karry CONDO CHURAUMI', type: 'stay', travelTime: 'ç´„20åˆ†', notes: '' }
                ],
                3: [ // 3/31 (Day 4)
                    { id: 401, time: '09:30', title: 'MOKULELE', location: '872ãƒ¼9 Ohama, Motobu, Kunigami District, Okinawa 905-0212æ—¥æœ¬', type: 'food', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-18:00\nåƒæ—©é¤' },
                    { id: 402, time: '11:00', title: 'Yabu River Rainbow Park', location: 'å±‹éƒ¨å·ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ‘ãƒ¼ã‚¯', type: 'sightseeing', travelTime: 'ç´„20åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘24å°æ™‚é–‹æ”¾\nå…¬åœ’' },
                    { id: 403, time: '12:30', title: 'æ½›æ°´å“¡ç‰›æ’', location: 'Restaurant ãµã‚Šã£ã±ãƒ¼', type: 'food', travelTime: 'ç´„20åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-22:00\nåˆé¤' },
                    { id: 404, time: '14:30', title: 'ç‰çƒéŠ˜è“ ä¸‰çŸ¢æœ¬èˆ— æ©ç´åº—', location: 'ç‰çƒéŠ˜è“ ä¸‰çŸ¢æœ¬èˆ— æ©ç´åº—', type: 'food', travelTime: 'ç´„30åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-18:00\nå¿…åƒä¸‰çŸ¢çƒ(æ²™ç¿)ï¼' },
                    { id: 405, time: '16:00', title: 'ç¾åœ‹æ‘', location: 'ç¾æµœã‚¿ã‚¦ãƒ³ãƒªã‚¾ãƒ¼ãƒˆãƒ»ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ“ãƒ¬ãƒƒã‚¸', type: 'shopping', travelTime: 'ç´„30åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-22:00 (ä¾åº—å®¶)\né€›è¡—' },
                    { id: 406, time: '19:00', title: 'ä½å®¿ Check-in', location: 'ã‚¢ã‚¯ã‚¢ãƒªã‚¾ãƒ¼ãƒˆã‚¤ãƒ³åŒ—è°·', type: 'stay', travelTime: 'ç´„5åˆ†', notes: 'Check-in: 15:00-22:00' }
                ],
                4: [ // 4/1 (Day 5)
                    { id: 501, time: '09:30', title: 'Hanon', location: 'ã‚·ãƒ¼ã‚µã‚¤ãƒ‰ã‚«ãƒ•ã‚§ãƒãƒãƒ³ åŒ—è°·', type: 'food', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘09:00-19:00 (é€±æœ«08:00èµ·)\nåƒæ—©é¤' },
                    { id: 502, time: '10:30', title: 'Parco City', location: 'ã‚µãƒ³ã‚¨ãƒ¼ æµ¦æ·»è¥¿æµ·å²¸ãƒ‘ãƒ«ã‚³ã‚·ãƒ†ã‚£', type: 'shopping', travelTime: 'ç´„25åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-22:00' },
                    { id: 503, time: '13:00', title: 'æ•˜æ•˜è‹‘ç‡’è‚‰', location: 'å™ã€…è‹‘ ã‚µãƒ³ã‚¨ãƒ¼æµ¦æ·»è¥¿æµ·å²¸ãƒ‘ãƒ«ã‚³ã‚·ãƒ†ã‚£åº—', type: 'food', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘11:00-22:00\nåˆé¤' },
                    { id: 504, time: '18:00', title: 'ç¾åœ‹æ‘æ™šé¤', location: 'ç¾æµœã‚¿ã‚¦ãƒ³ãƒªã‚¾ãƒ¼ãƒˆãƒ»ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ“ãƒ¬ãƒƒã‚¸', type: 'food', travelTime: 'ç´„25åˆ†', notes: 'é †ä¾¿å»ä¾¿åˆ©å•†åº—è²·éš”å¤©æ—©é¤' },
                    { id: 505, time: '20:30', title: 'å›ä½å®¿', location: 'ã‚¢ã‚¯ã‚¢ãƒªã‚¾ãƒ¼ãƒˆã‚¤ãƒ³åŒ—è°·', type: 'stay', travelTime: 'ç´„5åˆ†', notes: '' }
                ],
                5: [ // 4/2 (Day 6)
                    { id: 601, time: '08:00', title: 'æº–æ™‚å‡ºç™¼', location: 'ã‚¢ã‚¯ã‚¢ãƒªã‚¾ãƒ¼ãƒˆã‚¤ãƒ³åŒ—è°·', type: 'transport', notes: 'æº–å‚™å‰å¾€æ°´æ—é¤¨' },
                    { id: 602, time: '09:00', title: 'DMM æ°´æ—é¤¨', location: 'DMMã‹ã‚Šã‚†ã—æ°´æ—é¤¨', type: 'sightseeing', travelTime: 'ç´„50åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘09:00-20:00\nè²·ç¥¨/é€›é¤¨' },
                    { id: 603, time: '10:00', title: 'èˆ‡è²“é ­é·¹åˆå½±', location: 'DMMã‹ã‚Šã‚†ã—æ°´æ—é¤¨', type: 'sightseeing', notes: '10:00~11:00 å«é¤µé£Ÿ' },
                    { id: 604, time: '12:30', title: 'iias å•†å ´', location: 'ã‚¤ãƒ¼ã‚¢ã‚¹æ²–ç¸„è±Šå´', type: 'food', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-21:00\nåƒåˆé¤' },
                    { id: 605, time: '13:30', title: 'é€›å•†å ´', location: 'ã‚¤ãƒ¼ã‚¢ã‚¹æ²–ç¸„è±Šå´', type: 'shopping', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-21:00\næˆ–å»è²“å’ªå’–å•¡å»³' },
                    { id: 606, time: '16:30', title: 'OTS é‚„è»Š', location: 'OTSãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ è‡¨ç©ºè±Šå´å–¶æ¥­æ‰€', type: 'transport', travelTime: 'ç´„10åˆ†', notes: '19:00 é—œé–€' },
                    { id: 607, time: '17:00', title: 'æ­è¨ˆç¨‹è»Š', location: 'To Naha', type: 'transport', notes: 'å›ä½å®¿' },
                    { id: 608, time: '18:30', title: 'MAIKAI', location: 'MAIKAI -Fresh Juice & Acai Bowl-', type: 'food', travelTime: 'ç´„20åˆ†', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘08:00-20:00\nè²·å·´è¥¿è—è“ç¢— / è¦é£¯' },
                    { id: 609, time: '19:30', title: 'Tokyu Stay Check-in', location: 'æ±æ€¥ã‚¹ãƒ†ã‚¤æ²–ç¸„é‚£è¦‡', type: 'stay', travelTime: 'ç´„15åˆ†', travelMode: 'walk', notes: 'é€›æ¨“ä¸‹å”å‰è»»å¾·' }
                ],
                6: [ // 4/3 (Day 7)
                    { id: 700, time: '09:00', title: 'æ­å–®è»Œåˆ°ç‰§å¿—ç«™', location: 'ç‰§å¿—é§…', type: 'transport', travelMode: 'train', notes: 'æº–å‚™å»ç§Ÿè»Š' },
                    { id: 701, time: '09:30', title: 'ç§Ÿé›»å‹•è…³è¸è»Š', location: 'e-CHARIty é‚£è¦‡å›½éš›é€šã‚Šåº—', type: 'transport', travelTime: 'ç´„10åˆ†', travelMode: 'walk', notes: '' },
                    { id: 702, time: '10:00', title: 'ç‰§å¿—å¸‚å ´', location: 'ç¬¬ä¸€ç‰§å¿—å…¬è¨­å¸‚å ´', type: 'food', travelTime: 'ç´„5åˆ†', travelMode: 'bike', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘08:00-21:00\nåƒæ—©é¤' },
                    { id: 703, time: '11:30', title: 'å£ºå±‹é€š', location: 'å£ºå±‹ã‚„ã¡ã‚€ã‚“é€šã‚Š', type: 'sightseeing', travelTime: 'ç´„5åˆ†', travelMode: 'bike', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-18:00 (ä¾åº—å®¶)\nå‚³çµ±é™¶å™¨å·¥æˆ¿' },
                    { id: 704, time: '13:30', title: 'è¥¿ä¾†é™¢é”æ‘©å¯º', location: 'è¥¿æ¥é™¢ (é”ç£¨å¯º)', type: 'sightseeing', travelTime: 'ç´„20åˆ†', travelMode: 'bike', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘09:00-18:00' },
                    { id: 705, time: '14:00', title: 'Nanahoshi Shokudo', location: 'ãªãªã»ã—é£Ÿå ‚', type: 'food', travelTime: 'ç´„5åˆ†', travelMode: 'bike', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘10:00-20:00\nåƒåˆé¤' },
                    { id: 706, time: '16:30', title: 'é‚„é›»å‹•è…³è¸è»Š', location: 'e-CHARIty é‚£è¦‡å›½éš›é€šã‚Šåº—', type: 'transport', travelTime: 'ç´„20åˆ†', travelMode: 'bike', notes: '' },
                    { id: 707, time: '17:00', title: 'å…¨å®¶è¶…å•†', location: 'ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ å›½éš›é€šã‚Šç‰§å¿—é§…å‰åº—', type: 'shopping', travelTime: 'ç´„5åˆ†', travelMode: 'walk', notes: 'è²·éš”å¤©æ—©é¤' },
                    { id: 710, time: '17:20', title: 'æ­å–®è»Œç§»å‹•', location: 'çœŒåºå‰é§…', type: 'transport', travelMode: 'train', notes: 'ç‰§å¿—ç«™ åˆ° ç¸£å»³å‰ç«™' },
                    { id: 708, time: '18:30', title: 'Marutama å‘³å™Œé£¯å±‹', location: 'å‘³å™Œã‚ã—ã‚„ ã¾ã‚‹ãŸã¾', type: 'food', travelTime: 'ç´„10åˆ†', travelMode: 'walk', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘07:30-22:00 (é€±å››ä¼‘)\nèµ°è·¯å»åƒæ™šé¤' },
                    { id: 709, time: '19:30', title: 'å”å‰è»»å¾·', location: 'ãƒ‰ãƒ³ãƒ»ã‚­ãƒ›ãƒ¼ãƒ† å›½éš›é€šã‚Šåº—', type: 'shopping', travelTime: 'ç´„5åˆ†', travelMode: 'walk', notes: 'ã€ç‡Ÿæ¥­æ™‚é–“ã€‘24å°æ™‚ç‡Ÿæ¥­\næœ€çµ‚æ¡è³¼' }
                ],
                7: [ // 4/4 (Day 8)
                    { id: 801, time: '09:00', title: 'é‚£éœ¸æ©Ÿå ´', location: 'é‚£è¦‡ç©ºæ¸¯', type: 'transport', travelTime: 'ç´„20åˆ†', notes: 'å›å®¶å›‰ï¼' }
                ]
            };

            const expenses = ref([
                { id: 1, title: 'æ©Ÿç¥¨é ä»˜æ¬¾', amount: 80000, category: 'transport', payer: 'Me' },
                { id: 2, title: 'Lawson å®µå¤œ', amount: 1200, category: 'food', payer: 'Partner' },
            ]);

            const expenseCategories = [
                { id: 'food', name: 'ç¾é£Ÿ', emoji: 'ğŸœ' },
                { id: 'transport', name: 'äº¤é€š', emoji: 'ğŸš•' },
                { id: 'shopping', name: 'è³¼ç‰©', emoji: 'ğŸ›ï¸' },
                { id: 'stay', name: 'ä½å®¿', emoji: 'ğŸ¨' },
                { id: 'ticket', name: 'é–€ç¥¨', emoji: 'ğŸŸï¸' },
            ];

            const newExpense = ref({
                title: '',
                amount: '',
                category: 'food',
                payer: 'Me'
            });

            // Computed
            const countdown = computed(() => {
                const diffTime = Math.abs(tripDate - today);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                return diffDays;
            });

            const currentItinerary = computed(() => {
                return itineraryData[selectedDay.value] || [];
            });

            const totalExpenseJPY = computed(() => {
                return expenses.value.reduce((sum, item) => sum + item.amount, 0);
            });

            const totalExpenseTWD = computed(() => {
                return Math.round(totalExpenseJPY.value * 0.22);
            });

            const sortedExpenses = computed(() => {
                return [...expenses.value].reverse();
            });

            // Methods
            const formatNumber = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };

            const getCategoryColor = (type) => {
                const map = {
                    food: 'bg-orange-100 text-orange-600',
                    sightseeing: 'bg-green-100 text-green-600',
                    transport: 'bg-blue-100 text-blue-600',
                    stay: 'bg-purple-100 text-purple-600',
                    shopping: 'bg-pink-100 text-pink-600',
                    ticket: 'bg-yellow-100 text-yellow-600'
                };
                return map[type] || 'bg-gray-100';
            };
            
            const getCategoryBg = (type) => {
                 const map = {
                    food: 'bg-orange-100',
                    sightseeing: 'bg-green-100',
                    transport: 'bg-blue-100',
                    stay: 'bg-purple-100',
                    shopping: 'bg-pink-100',
                    ticket: 'bg-yellow-100'
                };
                return map[type] || 'bg-gray-100';
            };

            const getCategoryName = (type) => {
                const map = { 
                    food: 'ç¾é£Ÿ', 
                    sightseeing: 'æ™¯é»', 
                    transport: 'äº¤é€š', 
                    stay: 'ä½å®¿', 
                    shopping: 'è³¼ç‰©',
                    ticket: 'é–€ç¥¨'
                };
                return map[type] || type;
            };
            
            const getCategoryEmoji = (type) => {
                 const map = { 
                    food: 'ğŸœ', 
                    sightseeing: 'ğŸ“·', 
                    transport: 'ğŸš—', 
                    stay: 'ğŸ›ï¸',
                    shopping: 'ğŸ›ï¸',
                    ticket: 'ğŸŸï¸'
                 };
                return map[type] || 'âœ¨';
            };

            const getCategoryIcon = (catId) => {
                const cat = expenseCategories.find(c => c.id === catId);
                return cat ? cat.emoji : 'ğŸ’°';
            };

            // Custom Keypad Logic
            const appendNumber = (n) => {
                if (n === '.' && newExpense.value.amount.includes('.')) return;
                newExpense.value.amount += n.toString();
            };

            const backspaceNumber = () => {
                newExpense.value.amount = newExpense.value.amount.slice(0, -1);
            };

            const addExpense = () => {
                if (!newExpense.value.amount || !newExpense.value.title) return;
                expenses.value.push({
                    id: Date.now(),
                    title: newExpense.value.title,
                    amount: parseFloat(newExpense.value.amount),
                    category: newExpense.value.category,
                    payer: newExpense.value.payer
                });
                newExpense.value.title = '';
                newExpense.value.amount = '';
                showExpenseModal.value = false;
            };

            // Init Icons
            onMounted(() => {
                lucide.createIcons();
            });

            // Re-render icons when DOM updates
            onUpdated(() => {
                lucide.createIcons();
            });

            return {
                currentTab,
                selectedDay,
                days,
                currentItinerary,
                expenses,
                totalExpenseJPY,
                totalExpenseTWD,
                sortedExpenses,
                showExpenseModal,
                newExpense,
                expenseCategories,
                countdown,
                formatNumber,
                getCategoryColor,
                getCategoryName,
                getCategoryBg,
                getCategoryEmoji,
                getCategoryIcon,
                appendNumber,
                backspaceNumber,
                addExpense,
                activeBookingTab,
                bookingTabs
            };
        }
    }).mount('#app');
</script>
</body>
</html>
